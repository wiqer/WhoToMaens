# åç«¯ä»£ç ä¼˜åŒ–å·¥å…·æ¨èï¼ˆä¸‰è‰²æ ‡è®°ç‰ˆï¼‰

åŸºäºå¯¹é¡¹ç›®ç»“æ„å’Œä»£ç çš„åˆ†æï¼Œä»¥ä¸‹æ˜¯å¯ä»¥åŠ å…¥çš„æ’ä»¶ã€æ¡†æ¶å’Œå·¥å…·ï¼Œä»¥ä¼˜åŒ–åç«¯ä»£ç å¹¶å‡å°‘ç»´æŠ¤æˆæœ¬ã€‚æ¯ä¸ªå·¥å…·éƒ½æ ¹æ®å‘½ä»¤ç®€å•æ€§ã€å‰¯ä½œç”¨å¤§å°å’Œå¼•å…¥åé—®é¢˜å‡å°‘ç¨‹åº¦è¿›è¡Œäº†ä¸‰è‰²æ ‡è®°ï¼š
- ğŸŸ¢ ç»¿è‰²ï¼šå‘½ä»¤ç®€å•ã€å‰¯ä½œç”¨å°ã€å¼•å…¥åé—®é¢˜æ˜æ˜¾å‡å°‘
- ğŸŸ¡ é»„è‰²ï¼šå‘½ä»¤ä¸­ç­‰å¤æ‚åº¦ã€æœ‰ä¸€å®šå‰¯ä½œç”¨ã€å¼•å…¥åé—®é¢˜æœ‰æ‰€å‡å°‘
- ğŸ”´ çº¢è‰²ï¼šå‘½ä»¤å¤æ‚ã€å‰¯ä½œç”¨å¤§ã€å¼•å…¥åé—®é¢˜å¯èƒ½å¢åŠ 

## ä¸€ã€ä»£ç è´¨é‡å’Œæ ¼å¼åŒ–å·¥å…·

### 1. pre-commit ğŸŸ¢
- **ä½œç”¨**ï¼šåœ¨ä»£ç æäº¤å‰è‡ªåŠ¨è¿è¡Œä»£ç æ£€æŸ¥å’Œæ ¼å¼åŒ–å·¥å…·
- **æ¨èç†ç”±**ï¼šç¡®ä¿æ‰€æœ‰æäº¤çš„ä»£ç éƒ½ç¬¦åˆé¡¹ç›®çš„ä»£ç è§„èŒƒ
- **é›†æˆæ–¹å¼**ï¼š
```bash
pip install pre-commit
pre-commit install
```
- **é…ç½®æ–‡ä»¶**ï¼šåˆ›å»º`.pre-commit-config.yaml`æ–‡ä»¶ï¼ŒåŒ…å«blackã€flake8ã€isortç­‰å·¥å…·

### 2. mypy ğŸŸ¢
- **ä½œç”¨**ï¼šé™æ€ç±»å‹æ£€æŸ¥å™¨ï¼Œç¡®ä¿ç±»å‹æ³¨è§£çš„æ­£ç¡®æ€§
- **æ¨èç†ç”±**ï¼šæé«˜ä»£ç å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œå‡å°‘ç±»å‹ç›¸å…³çš„é”™è¯¯
- **é›†æˆæ–¹å¼**ï¼š
```bash
pip install mypy
```
- **é…ç½®æ–‡ä»¶**ï¼šåˆ›å»º`mypy.ini`æ–‡ä»¶ï¼Œé…ç½®ç±»å‹æ£€æŸ¥çš„ä¸¥æ ¼ç¨‹åº¦

## äºŒã€æµ‹è¯•æ¡†æ¶å’Œè¦†ç›–ç‡

### 1. pytest-cov ğŸŸ¢
- **ä½œç”¨**ï¼šç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
- **æ¨èç†ç”±**ï¼šäº†è§£æµ‹è¯•è¦†ç›–æƒ…å†µï¼Œæ‰¾å‡ºæœªæµ‹è¯•çš„ä»£ç éƒ¨åˆ†
- **é›†æˆæ–¹å¼**ï¼š
```bash
pip install pytest-cov
pytest --cov=src tests/
```

### 2. pytest-mock ğŸŸ¢
- **ä½œç”¨**ï¼šæä¾›æ›´å¼ºå¤§çš„mockåŠŸèƒ½
- **æ¨èç†ç”±**ï¼šç®€åŒ–æµ‹è¯•ä¸­çš„mockå¯¹è±¡åˆ›å»ºå’Œç®¡ç†
- **é›†æˆæ–¹å¼**ï¼š
```bash
pip install pytest-mock
```

### 3. tox ğŸŸ¡
- **ä½œç”¨**ï¼šç®¡ç†ä¸åŒPythonç‰ˆæœ¬å’Œç¯å¢ƒçš„æµ‹è¯•
- **æ¨èç†ç”±**ï¼šç¡®ä¿ä»£ç åœ¨ä¸åŒç¯å¢ƒä¸‹éƒ½èƒ½æ­£å¸¸å·¥ä½œ
- **é›†æˆæ–¹å¼**ï¼š
```bash
pip install tox
```
- **é…ç½®æ–‡ä»¶**ï¼šåˆ›å»º`tox.ini`æ–‡ä»¶ï¼Œé…ç½®æµ‹è¯•ç¯å¢ƒå’Œå‘½ä»¤

## ä¸‰ã€ä»£ç åˆ†æå’Œé‡æ„å·¥å…·

### 1. pylint ğŸŸ¢
- **ä½œç”¨**ï¼šå…¨é¢çš„ä»£ç åˆ†æå·¥å…·ï¼Œæ£€æŸ¥ä»£ç é£æ ¼ã€é”™è¯¯å’Œæ½œåœ¨é—®é¢˜
- **æ¨èç†ç”±**ï¼šæ¯”flake8æ›´å…¨é¢çš„ä»£ç æ£€æŸ¥
- **é›†æˆæ–¹å¼**ï¼š
```bash
pip install pylint
pylint src/
```

### 2. bandit ğŸŸ¢
- **ä½œç”¨**ï¼šæ£€æŸ¥ä»£ç ä¸­çš„å®‰å…¨æ¼æ´
- **æ¨èç†ç”±**ï¼šæé«˜ä»£ç å®‰å…¨æ€§ï¼Œé˜²æ­¢å¸¸è§çš„å®‰å…¨é—®é¢˜
- **é›†æˆæ–¹å¼**ï¼š
```bash
pip install bandit
bandit -r src/
```

### 3. radon ğŸŸ¡
- **ä½œç”¨**ï¼šåˆ†æä»£ç å¤æ‚åº¦
- **æ¨èç†ç”±**ï¼šè¯†åˆ«å¤æ‚çš„ä»£ç éƒ¨åˆ†ï¼Œä¾¿äºé‡æ„
- **é›†æˆæ–¹å¼**ï¼š
```bash
pip install radon
radon cc src/
```

### 4. isort ğŸŸ¢
- **ä½œç”¨**ï¼šè‡ªåŠ¨æ’åºå¯¼å…¥è¯­å¥
- **æ¨èç†ç”±**ï¼šä¿æŒä¸€è‡´çš„å¯¼å…¥é£æ ¼ï¼Œæé«˜ä»£ç å¯è¯»æ€§
- **é›†æˆæ–¹å¼**ï¼š
```bash
pip install isort
isort src/
```

## å››ã€æ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–

### 1. Prometheus + Grafana ğŸ”´
- **ä½œç”¨**ï¼šç›‘æ§ç³»ç»Ÿæ€§èƒ½å’Œèµ„æºä½¿ç”¨æƒ…å†µ
- **æ¨èç†ç”±**ï¼šæä¾›æ›´å…¨é¢ã€å¯è§†åŒ–çš„ç›‘æ§ç•Œé¢
- **é›†æˆæ–¹å¼**ï¼š
  1. å®‰è£…Prometheuså’ŒGrafana
  2. ä½¿ç”¨`prometheus_client`åº“å°†æŒ‡æ ‡æš´éœ²ç»™Prometheus
  3. åœ¨Grafanaä¸­åˆ›å»ºä»ªè¡¨ç›˜

### 2. line_profiler ğŸŸ¢
- **ä½œç”¨**ï¼šåˆ†æä»£ç è¡Œçº§åˆ«çš„æ€§èƒ½ç“¶é¢ˆ
- **æ¨èç†ç”±**ï¼šç²¾ç¡®æ‰¾å‡ºæ€§èƒ½é—®é¢˜æ‰€åœ¨
- **é›†æˆæ–¹å¼**ï¼š
```bash
pip install line_profiler
```
- **ä½¿ç”¨æ–¹æ³•**ï¼šåœ¨ä»£ç ä¸­æ·»åŠ `@profile`è£…é¥°å™¨ï¼Œç„¶åè¿è¡Œ`kernprof -l -v script.py`

### 3. memory_profiler ğŸŸ¢
- **ä½œç”¨**ï¼šç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ
- **æ¨èç†ç”±**ï¼šæ‰¾å‡ºå†…å­˜æ³„æ¼å’Œé«˜å†…å­˜ä½¿ç”¨çš„ä»£ç éƒ¨åˆ†
- **é›†æˆæ–¹å¼**ï¼š
```bash
pip install memory_profiler
```
- **ä½¿ç”¨æ–¹æ³•**ï¼šåœ¨ä»£ç ä¸­æ·»åŠ `@profile`è£…é¥°å™¨ï¼Œç„¶åè¿è¡Œ`python -m memory_profiler script.py`

## äº”ã€APIæ–‡æ¡£å’Œè§„èŒƒ

### 1. Redoc ğŸŸ¢
- **ä½œç”¨**ï¼šæä¾›æ›´ç¾è§‚çš„APIæ–‡æ¡£
- **æ¨èç†ç”±**ï¼šæ¯”Swaggeræ›´ç°ä»£ã€æ›´ç¾è§‚çš„APIæ–‡æ¡£ç•Œé¢
- **é›†æˆæ–¹å¼**ï¼š
```bash
pip install redoc-fastapi
```
- **ä½¿ç”¨æ–¹æ³•**ï¼šåœ¨FastAPIåº”ç”¨ä¸­æ·»åŠ Redocæ–‡æ¡£ç«¯ç‚¹

### 2. mkdocs ğŸŸ¡
- **ä½œç”¨**ï¼šç”Ÿæˆé¡¹ç›®æ–‡æ¡£
- **æ¨èç†ç”±**ï¼šåˆ›å»ºæ˜“äºæµè§ˆçš„é¡¹ç›®æ–‡æ¡£ç½‘ç«™
- **é›†æˆæ–¹å¼**ï¼š
```bash
pip install mkdocs mkdocs-material
mkdocs new docs
```
- **é…ç½®æ–‡ä»¶**ï¼šä¿®æ”¹`mkdocs.yml`æ–‡ä»¶ï¼Œé…ç½®æ–‡æ¡£ä¸»é¢˜å’Œç»“æ„

### 3. openapi-generator ğŸŸ¡
- **ä½œç”¨**ï¼šæ ¹æ®OpenAPIè§„èŒƒç”Ÿæˆå®¢æˆ·ç«¯ä»£ç 
- **æ¨èç†ç”±**ï¼šè‡ªåŠ¨ç”Ÿæˆå®¢æˆ·ç«¯ä»£ç ï¼Œå‡å°‘æ‰‹åŠ¨ç¼–å†™çš„é”™è¯¯
- **é›†æˆæ–¹å¼**ï¼š
  1. å®‰è£…openapi-generator
  2. è¿è¡Œ`openapi-generator generate -i http://localhost:8000/openapi.json -g python -o client/`

## å…­ã€ä¾èµ–ç®¡ç†

### 1. pip-tools ğŸŸ¢
- **ä½œç”¨**ï¼šç®¡ç†ä¾èµ–ç‰ˆæœ¬
- **æ¨èç†ç”±**ï¼šç¡®ä¿ä¾èµ–ç‰ˆæœ¬çš„ä¸€è‡´æ€§ï¼Œé¿å…ç‰ˆæœ¬å†²çª
- **é›†æˆæ–¹å¼**ï¼š
```bash
pip install pip-tools
```
- **ä½¿ç”¨æ–¹æ³•**ï¼šåˆ›å»º`requirements.in`æ–‡ä»¶ï¼Œç„¶åè¿è¡Œ`pip-compile requirements.in`ç”Ÿæˆ`requirements.txt`

### 2. poetry ğŸŸ¡
- **ä½œç”¨**ï¼šåŒ…ç®¡ç†å’Œä¾èµ–è§£æå·¥å…·
- **æ¨èç†ç”±**ï¼šæ›´ç°ä»£çš„ä¾èµ–ç®¡ç†æ–¹å¼ï¼Œæ”¯æŒè™šæ‹Ÿç¯å¢ƒç®¡ç†
- **é›†æˆæ–¹å¼**ï¼š
```bash
pip install poetry
poetry init
```

## ä¸ƒã€CI/CDé›†æˆ

### 1. GitHub Actions æˆ– GitLab CI ğŸŸ¡
- **ä½œç”¨**ï¼šè‡ªåŠ¨åŒ–æµ‹è¯•å’Œéƒ¨ç½²
- **æ¨èç†ç”±**ï¼šå‡å°‘æ‰‹åŠ¨æ“ä½œï¼Œæé«˜å¼€å‘æ•ˆç‡
- **é›†æˆæ–¹å¼**ï¼š
  1. åœ¨`.github/workflows/`æˆ–`.gitlab-ci.yml`ä¸­é…ç½®CI/CDæµç¨‹
  2. é…ç½®æµ‹è¯•ã€æ„å»ºå’Œéƒ¨ç½²æ­¥éª¤

## å…«ã€å®‰å…¨å·¥å…·

### 1. safety ğŸŸ¢
- **ä½œç”¨**ï¼šæ£€æŸ¥ä¾èµ–åŒ…çš„å®‰å…¨æ¼æ´
- **æ¨èç†ç”±**ï¼šåŠæ—¶å‘ç°å’Œä¿®å¤ä¾èµ–åŒ…çš„å®‰å…¨é—®é¢˜
- **é›†æˆæ–¹å¼**ï¼š
```bash
pip install safety
safety check
```

### 2. OWASP ZAP ğŸŸ¡
- **ä½œç”¨**ï¼šè¿›è¡ŒAPIå®‰å…¨æµ‹è¯•
- **æ¨èç†ç”±**ï¼šå‘ç°APIä¸­çš„å®‰å…¨æ¼æ´
- **é›†æˆæ–¹å¼**ï¼š
  1. å®‰è£…OWASP ZAP
  2. è¿è¡ŒAPIå®‰å…¨æµ‹è¯•

### 3. secretlint ğŸŸ¢
- **ä½œç”¨**ï¼šæ£€æµ‹ä»£ç ä¸­çš„æ•æ„Ÿä¿¡æ¯
- **æ¨èç†ç”±**ï¼šé˜²æ­¢æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚APIå¯†é’¥ï¼‰è¢«æäº¤åˆ°ä»£ç åº“
- **é›†æˆæ–¹å¼**ï¼š
```bash
npm install -g secretlint
secretlint "**/*"
```

## ä¹ã€ä»£ç é£æ ¼ä¼˜åŒ–è§„å®š

é™¤äº†ä½¿ç”¨ä¸Šè¿°å·¥å…·å¤–ï¼Œä»¥ä¸‹ä»£ç é£æ ¼ä¼˜åŒ–è§„å®šå¯ä»¥å¸®åŠ©ç®€åŒ–å¼€å‘ã€é™ä½ç†è§£å’Œç»´æŠ¤æˆæœ¬ï¼š

### 1. åˆ†å±‚å¼€å‘ ğŸŸ¢
- **åŸåˆ™**ï¼šå°†ä»£ç æŒ‰ç…§åŠŸèƒ½å’ŒèŒè´£åˆ’åˆ†ä¸ºä¸åŒçš„å±‚æ¬¡ï¼ˆå¦‚APIå±‚ã€ä¸šåŠ¡é€»è¾‘å±‚ã€æ•°æ®è®¿é—®å±‚ï¼‰
- **å¥½å¤„**ï¼šæé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æµ‹è¯•æ€§ï¼Œé™ä½æ¨¡å—é—´çš„è€¦åˆåº¦
- **å®è·µ**ï¼š
  - APIå±‚ï¼šå¤„ç†è¯·æ±‚/å“åº”ã€å‚æ•°éªŒè¯
  - ä¸šåŠ¡é€»è¾‘å±‚ï¼šå®ç°æ ¸å¿ƒä¸šåŠ¡è§„åˆ™
  - æ•°æ®è®¿é—®å±‚ï¼šä¸æ•°æ®åº“äº¤äº’

### 2. åˆ†æ”¯ä»£ç å¿«é€Ÿå¤±è´¥é™ä½åœˆå¤æ‚åº¦ ğŸŸ¢
- **åŸåˆ™**ï¼šåœ¨å‡½æ•°å¼€å§‹æ—¶å°±æ£€æŸ¥è¾“å…¥å‚æ•°çš„æœ‰æ•ˆæ€§ï¼Œé¿å…åµŒå¥—çš„æ¡ä»¶åˆ¤æ–­
- **å¥½å¤„**ï¼šé™ä½ä»£ç çš„åœˆå¤æ‚åº¦ï¼Œæé«˜å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§
- **ç¤ºä¾‹**ï¼š
```python
# ä¸æ¨è
def process_data(data, options=None):
    if data is not None:
        if options is not None:
            # å¤„ç†æ•°æ®
            return result
        else:
            return None
    else:
        return None

# æ¨è
def process_data(data, options=None):
    if data is None:
        return None
    if options is None:
        return None
    # å¤„ç†æ•°æ®
    return result
```

### 3. è¾“å…¥å‚æ•°ä½¿ç”¨å¯¹è±¡ä¼ é€’é™ä½ç†è§£æˆæœ¬ ğŸŸ¡
- **åŸåˆ™**ï¼šå½“å‡½æ•°å‚æ•°è¾ƒå¤šæ—¶ï¼Œä½¿ç”¨æ•°æ®ç±»æˆ–å­—å…¸å°è£…å‚æ•°
- **å¥½å¤„**ï¼šæé«˜ä»£ç å¯è¯»æ€§ï¼Œå‡å°‘å‚æ•°ä¼ é€’é”™è¯¯
- **ç¤ºä¾‹**ï¼š
```python
# ä¸æ¨è
def create_user(username, email, password, first_name, last_name, age, address):
    # åˆ›å»ºç”¨æˆ·
    pass

# æ¨è
from dataclasses import dataclass

@dataclass
class UserCreate:
    username: str
    email: str
    password: str
    first_name: str
    last_name: str
    age: int
    address: str

def create_user(user_data: UserCreate):
    # åˆ›å»ºç”¨æˆ·
    pass
```

### 4. æŠ½å–ç±»ä¼¼ä»£ç é™ä½ç»´æŠ¤æˆæœ¬æ˜ç¡®è¯­æ„ ğŸŸ¢
- **åŸåˆ™**ï¼šå°†é‡å¤æˆ–ç±»ä¼¼çš„ä»£ç æŠ½å–æˆå‡½æ•°æˆ–æ–¹æ³•
- **å¥½å¤„**ï¼šå‡å°‘ä»£ç é‡å¤ï¼Œæé«˜ç»´æŠ¤æ€§ï¼Œæ˜ç¡®ä»£ç è¯­æ„
- **ç¤ºä¾‹**ï¼š
```python
# ä¸æ¨è
def process_order(order):
    # éªŒè¯è®¢å•
    if not order.is_valid():
        raise ValueError("Invalid order")
    # è®¡ç®—ä»·æ ¼
    price = order.calculate_price()
    # ä¿å­˜è®¢å•
    order.save()
    return price

def process_payment(payment):
    # éªŒè¯æ”¯ä»˜
    if not payment.is_valid():
        raise ValueError("Invalid payment")
    # è®¡ç®—é‡‘é¢
    amount = payment.calculate_amount()
    # ä¿å­˜æ”¯ä»˜
    payment.save()
    return amount

# æ¨è
def validate_and_process(entity):
    if not entity.is_valid():
        raise ValueError(f"Invalid {type(entity).__name__}")
    value = entity.calculate_value()
    entity.save()
    return value

def process_order(order):
    return validate_and_process(order)

def process_payment(payment):
    return validate_and_process(payment)
```

### 5. å¯¹ç±»ä¼¼åŠŸèƒ½åšç»Ÿä¸€æŠ½è±¡é˜²æ­¢å¤šä»½å®ç° ğŸŸ¡
- **åŸåˆ™**ï¼šè¯†åˆ«å…·æœ‰ç±»ä¼¼åŠŸèƒ½çš„ä»£ç ï¼Œåˆ›å»ºæŠ½è±¡åŸºç±»æˆ–æ¥å£
- **å¥½å¤„**ï¼šå‡å°‘é‡å¤å®ç°ï¼Œæé«˜ä»£ç ä¸€è‡´æ€§
- **ç¤ºä¾‹**ï¼š
```python
# ä¸æ¨è
class FileStorage:
    def save(self, data, path):
        # ä¿å­˜åˆ°æ–‡ä»¶
        pass
    def load(self, path):
        # ä»æ–‡ä»¶åŠ è½½
        pass

class DatabaseStorage:
    def save(self, data, id):
        # ä¿å­˜åˆ°æ•°æ®åº“
        pass
    def load(self, id):
        # ä»æ•°æ®åº“åŠ è½½
        pass

# æ¨è
from abc import ABC, abstractmethod

class Storage(ABC):
    @abstractmethod
    def save(self, data, identifier):
        pass
    @abstractmethod
    def load(self, identifier):
        pass

class FileStorage(Storage):
    def save(self, data, path):
        # ä¿å­˜åˆ°æ–‡ä»¶
        pass
    def load(self, path):
        # ä»æ–‡ä»¶åŠ è½½
        pass

class DatabaseStorage(Storage):
    def save(self, data, id):
        # ä¿å­˜åˆ°æ•°æ®åº“
        pass
    def load(self, id):
        # ä»æ•°æ®åº“åŠ è½½
        pass
```

### 6. ä½¿ç”¨ç°æœ‰å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’é™ä½ç†è§£æˆæœ¬ ğŸŸ¢
- **åŸåˆ™**ï¼šä¸è¦ä¸ºäº†ä¼ é€’å°‘é‡æ•°æ®è€Œåˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œè€Œæ˜¯ä½¿ç”¨ç°æœ‰çš„å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’
- **å¥½å¤„**ï¼šé™ä½ç†è§£æˆæœ¬ï¼Œå‡å°‘å¯¹è±¡åˆ›å»ºå¸¦æ¥çš„æ€§èƒ½å¼€é”€
- **ç¤ºä¾‹**ï¼š
```python
# ä¸æ¨è
class OrderProcessor:
    def calculate_total(self, items, discount_rate):
        subtotal = sum(item.price for item in items)
        discount = subtotal * discount_rate
        return subtotal - discount

# æ¨è
class OrderProcessor:
    def calculate_total(self, order):
        # ä½¿ç”¨ç°æœ‰orderå¯¹è±¡ï¼Œå†…éƒ¨è®¡ç®—æŠ˜æ‰£
        subtotal = sum(item.price for item in order.items)
        discount = subtotal * order.discount_rate
        return subtotal - discount
```

### 7. ç®€å•è¿ç®—åœ¨æ–¹æ³•å†…è®¡ç®—æé«˜å¯è¯»æ€§ ğŸŸ¢
- **åŸåˆ™**ï¼šå¯¹äºç®€å•çš„è®¡ç®—é€»è¾‘ï¼Œç›´æ¥åœ¨æ–¹æ³•å†…éƒ¨å®Œæˆï¼Œè€Œä¸æ˜¯ä¾èµ–å¤–éƒ¨ä¼ å…¥è®¡ç®—ç»“æœ
- **å¥½å¤„**ï¼šæé«˜ä»£ç å¯è¯»æ€§ï¼Œå‡å°‘å‚æ•°ä¼ é€’ï¼Œå‘ç°é¢†åŸŸå†…å…±è¯†
- **ç¤ºä¾‹**ï¼š
```python
# ä¸æ¨è
def process_order(order, discounted_price):
    # å¤„ç†è®¢å•é€»è¾‘
    order.final_price = discounted_price
    # å…¶ä»–å¤„ç†...

# æ¨è
def process_order(order):
    # åœ¨æ–¹æ³•å†…è®¡ç®—æŠ˜æ‰£ä»·æ ¼
    discounted_price = order.subtotal * (1 - order.discount_rate)
    order.final_price = discounted_price
    # å…¶ä»–å¤„ç†...
```

## æ€»ç»“

é€šè¿‡é›†æˆä»¥ä¸Šå·¥å…·å’Œéµå¾ªä»£ç é£æ ¼ä¼˜åŒ–è§„å®šï¼Œå¯ä»¥æ˜¾è‘—æé«˜åç«¯ä»£ç çš„è´¨é‡ã€å¯ç»´æŠ¤æ€§å’Œæ€§èƒ½ã€‚å»ºè®®æ ¹æ®é¡¹ç›®çš„å®é™…éœ€æ±‚å’Œå›¢é˜Ÿçš„ç†Ÿæ‚‰ç¨‹åº¦ï¼Œä¼˜å…ˆå¼•å…¥ç»¿è‰²æ ‡è®°çš„å·¥å…·å’Œå®è·µï¼Œç„¶åæ˜¯é»„è‰²æ ‡è®°çš„å·¥å…·å’Œå®è·µï¼Œæœ€åå†è€ƒè™‘çº¢è‰²æ ‡è®°çš„å·¥å…·ã€‚