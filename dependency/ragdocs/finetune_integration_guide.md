# BugAgaric å¾®è°ƒåŠŸèƒ½é›†æˆæŒ‡å—

## æ¦‚è¿°

æœ¬æ–‡æ¡£ä»‹ç»äº†BugAgaricé¡¹ç›®ä¸­å¾®è°ƒåŠŸèƒ½çš„å®Œæ•´å®ç°ï¼ŒåŒ…æ‹¬åç«¯APIã€å‰ç«¯ç•Œé¢å’Œç³»ç»Ÿé›†æˆã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ¯ æ”¯æŒçš„å¾®è°ƒç±»å‹
- **SFT (ç›‘ç£å¾®è°ƒ)**: åŸºäºæ ‡æ³¨æ•°æ®çš„ç›‘ç£å­¦ä¹ 
- **DPO (ç›´æ¥åå¥½ä¼˜åŒ–)**: åŸºäºäººç±»åå¥½çš„å¼ºåŒ–å­¦ä¹ 
- **Embedding (åµŒå…¥æ¨¡å‹)**: æ–‡æœ¬åµŒå…¥æ¨¡å‹å¾®è°ƒ
- **KBAlign (çŸ¥è¯†åº“å¯¹é½)**: çŸ¥è¯†åº“å¯¹é½å¾®è°ƒ

### ğŸ”§ æ ¸å¿ƒåŠŸèƒ½
- å¯è§†åŒ–é…ç½®ç•Œé¢
- å®æ—¶è®­ç»ƒç›‘æ§
- ä»»åŠ¡çŠ¶æ€ç®¡ç†
- è®­ç»ƒæ—¥å¿—æŸ¥çœ‹
- é…ç½®æ¨¡æ¿ç®¡ç†

## ç³»ç»Ÿæ¶æ„

### åç«¯æ¶æ„
```
go-services/api/
â”œâ”€â”€ services/finetune.go      # å¾®è°ƒæœåŠ¡æ ¸å¿ƒé€»è¾‘
â”œâ”€â”€ handlers/finetune.go      # APIå¤„ç†å™¨
â””â”€â”€ main.go                   # ä¸»ç¨‹åºï¼ˆå·²é›†æˆå¾®è°ƒè·¯ç”±ï¼‰
```

### å‰ç«¯æ¶æ„
```
frontend/src/
â”œâ”€â”€ pages/Finetune.jsx        # ä¸»å¾®è°ƒé¡µé¢
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ FinetuneConfig.jsx    # é…ç½®ç»„ä»¶
â”‚   â””â”€â”€ TaskMonitor.jsx       # ç›‘æ§ç»„ä»¶
â”œâ”€â”€ services/finetune.js      # å‰ç«¯APIæœåŠ¡
â””â”€â”€ config/api.js             # APIé…ç½®
```

## å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨ç³»ç»Ÿ
```bash
# ç»™å¯åŠ¨è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™
chmod +x start_finetune_system.sh

# å¯åŠ¨æ•´ä¸ªç³»ç»Ÿ
./start_finetune_system.sh
```

### 2. è®¿é—®ç³»ç»Ÿ
- å‰ç«¯ç•Œé¢: http://localhost:3000
- åç«¯API: http://localhost:18080
- å¾®è°ƒé¡µé¢: http://localhost:3000/finetune

### 3. å¼€å§‹å¾®è°ƒ
1. ç™»å½•ç³»ç»Ÿ
2. ç‚¹å‡»ä¾§è¾¹æ "æ¨¡å‹å¾®è°ƒ"
3. é€‰æ‹©å¾®è°ƒç±»å‹
4. é…ç½®è®­ç»ƒå‚æ•°
5. ç‚¹å‡»"å¼€å§‹è®­ç»ƒ"
6. åœ¨ç›‘æ§é¡µé¢æŸ¥çœ‹è¿›åº¦

## APIæ¥å£æ–‡æ¡£

### å¯åŠ¨å¾®è°ƒä»»åŠ¡
```http
POST /api/finetune/start
Content-Type: application/json

{
  "type": "sft",
  "config": {
    "model_name_or_path": "microsoft/DialoGPT-medium",
    "train_data_path": "data/train.jsonl",
    "output_dir": "output/sft",
    "use_lora": true,
    "learning_rate": 5e-5,
    "num_train_epochs": 3,
    "per_device_train_batch_size": 4
  }
}
```

### è·å–ä»»åŠ¡çŠ¶æ€
```http
GET /api/finetune/tasks/{task_id}
```

### è·å–ä»»åŠ¡æ—¥å¿—
```http
GET /api/finetune/tasks/{task_id}/logs?limit=100
```

### åœæ­¢ä»»åŠ¡
```http
DELETE /api/finetune/tasks/{task_id}
```

### åˆ é™¤ä»»åŠ¡
```http
DELETE /api/finetune/tasks/{task_id}/delete
```

### è·å–ä»»åŠ¡åˆ—è¡¨
```http
GET /api/finetune/tasks
```

### è·å–é…ç½®æ¨¡æ¿
```http
GET /api/finetune/templates
```

## é…ç½®è¯´æ˜

### SFT/DPOé…ç½®
```json
{
  "model_name_or_path": "æ¨¡å‹è·¯å¾„æˆ–HuggingFaceæ ‡è¯†ç¬¦",
  "train_data_path": "è®­ç»ƒæ•°æ®æ–‡ä»¶è·¯å¾„",
  "output_dir": "æ¨¡å‹è¾“å‡ºç›®å½•",
  "config_file": "é…ç½®æ–‡ä»¶è·¯å¾„",
  "use_lora": true,
  "learning_rate": 5e-5,
  "num_train_epochs": 3,
  "per_device_train_batch_size": 4
}
```

### Embeddingé…ç½®
```json
{
  "model_name_or_path": "åµŒå…¥æ¨¡å‹è·¯å¾„",
  "train_data": "è®­ç»ƒæ•°æ®è·¯å¾„",
  "output_dir": "è¾“å‡ºç›®å½•",
  "learning_rate": 2e-5,
  "num_train_epochs": 3,
  "per_device_train_batch_size": 16
}
```

### KBAligné…ç½®
```json
{
  "model_name_or_path": "æ¨¡å‹è·¯å¾„",
  "input_path": "è¾“å…¥æ•°æ®è·¯å¾„",
  "output_dir": "è¾“å‡ºç›®å½•",
  "gpu_vis": "0,1,2,3",
  "use_lora": true
}
```

## æ•°æ®æ ¼å¼

### SFT/DPOè®­ç»ƒæ•°æ®æ ¼å¼
```json
{
  "query": "ç”¨æˆ·æŸ¥è¯¢",
  "retrieval_result": "æ£€ç´¢ç»“æœ",
  "chosen": {
    "text": "ä¼˜é€‰å›ç­”"
  },
  "rejected": {
    "text": "è¢«æ‹’ç»çš„å›ç­”"
  }
}
```

### Embeddingè®­ç»ƒæ•°æ®æ ¼å¼
```json
{
  "query": "æŸ¥è¯¢æ–‡æœ¬",
  "pos": ["æ­£ä¾‹1", "æ­£ä¾‹2"],
  "neg": ["è´Ÿä¾‹1", "è´Ÿä¾‹2"]
}
```

## æµ‹è¯•

### è¿è¡ŒAPIæµ‹è¯•
```bash
python3 test_finetune_api.py
```

### æµ‹è¯•è¦†ç›–èŒƒå›´
- âœ… å¥åº·æ£€æŸ¥
- âœ… é…ç½®æ¨¡æ¿è·å–
- âœ… ä»»åŠ¡å¯åŠ¨
- âœ… çŠ¶æ€æŸ¥è¯¢
- âœ… æ—¥å¿—è·å–
- âœ… ä»»åŠ¡åˆ—è¡¨
- âœ… ä»»åŠ¡åœæ­¢
- âœ… ä»»åŠ¡åˆ é™¤

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. åç«¯æœåŠ¡å¯åŠ¨å¤±è´¥
```bash
# æ£€æŸ¥Goç¯å¢ƒ
go version

# æ£€æŸ¥ä¾èµ–
cd go-services/api
go mod tidy

# é‡æ–°ç¼–è¯‘
go build -o bugagaric-api main.go
```

#### 2. å‰ç«¯æœåŠ¡å¯åŠ¨å¤±è´¥
```bash
# æ£€æŸ¥Node.jsç¯å¢ƒ
node --version
npm --version

# å®‰è£…ä¾èµ–
cd frontend
npm install

# å¯åŠ¨æœåŠ¡
npm start
```

#### 3. å¾®è°ƒä»»åŠ¡å¯åŠ¨å¤±è´¥
- æ£€æŸ¥æ¨¡å‹è·¯å¾„æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥è®­ç»ƒæ•°æ®æ–‡ä»¶æ˜¯å¦å­˜åœ¨
- æ£€æŸ¥è¾“å‡ºç›®å½•æƒé™
- æŸ¥çœ‹åç«¯æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

#### 4. è®­ç»ƒè¿‡ç¨‹ä¸­æ–­
- æ£€æŸ¥GPUæ˜¾å­˜æ˜¯å¦å……è¶³
- æ£€æŸ¥ç£ç›˜ç©ºé—´æ˜¯å¦è¶³å¤Ÿ
- æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦ç¨³å®š

### æ—¥å¿—æŸ¥çœ‹
```bash
# æŸ¥çœ‹åç«¯æ—¥å¿—
tail -f go-services/api/logs/api.log

# æŸ¥çœ‹è®­ç»ƒæ—¥å¿—
tail -f output/logs/finetune.log
```

## æ€§èƒ½ä¼˜åŒ–

### åç«¯ä¼˜åŒ–
- ä½¿ç”¨è¿æ¥æ± ç®¡ç†æ•°æ®åº“è¿æ¥
- å®ç°ä»»åŠ¡é˜Ÿåˆ—é¿å…é˜»å¡
- æ·»åŠ ç¼“å­˜å‡å°‘é‡å¤è®¡ç®—

### å‰ç«¯ä¼˜åŒ–
- ä½¿ç”¨React.memoä¼˜åŒ–ç»„ä»¶æ¸²æŸ“
- å®ç°è™šæ‹Ÿæ»šåŠ¨å¤„ç†å¤§é‡æ•°æ®
- æ·»åŠ é˜²æŠ–å¤„ç†é¢‘ç¹è¯·æ±‚

### è®­ç»ƒä¼˜åŒ–
- ä½¿ç”¨LoRAå‡å°‘æ˜¾å­˜å ç”¨
- å¯ç”¨æ¢¯åº¦æ£€æŸ¥ç‚¹
- ä½¿ç”¨æ··åˆç²¾åº¦è®­ç»ƒ

## æ‰©å±•å¼€å‘

### æ·»åŠ æ–°çš„å¾®è°ƒç±»å‹
1. åœ¨`finetune.go`ä¸­æ·»åŠ æ–°çš„å‘½ä»¤æ„å»ºå‡½æ•°
2. åœ¨`handlers/finetune.go`ä¸­æ³¨å†Œæ–°çš„ç±»å‹
3. åœ¨å‰ç«¯é…ç½®ç»„ä»¶ä¸­æ·»åŠ å¯¹åº”çš„è¡¨å•
4. æ›´æ–°APIæ–‡æ¡£å’Œæµ‹è¯•ç”¨ä¾‹

### æ·»åŠ æ–°çš„ç›‘æ§æŒ‡æ ‡
1. åœ¨å¾®è°ƒè„šæœ¬ä¸­æ·»åŠ æŒ‡æ ‡æ”¶é›†
2. åœ¨APIä¸­æš´éœ²æŒ‡æ ‡æ¥å£
3. åœ¨å‰ç«¯æ·»åŠ å¯è§†åŒ–ç»„ä»¶

## è´¡çŒ®æŒ‡å—

### ä»£ç è§„èŒƒ
- éµå¾ªGoå’ŒJavaScriptçš„ç¼–ç è§„èŒƒ
- æ·»åŠ é€‚å½“çš„æ³¨é‡Šå’Œæ–‡æ¡£
- ç¼–å†™å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

### æäº¤è§„èŒƒ
- ä½¿ç”¨æ¸…æ™°çš„æäº¤ä¿¡æ¯
- ä¸€ä¸ªæäº¤åªåŒ…å«ä¸€ä¸ªåŠŸèƒ½
- æäº¤å‰è¿è¡Œæµ‹è¯•ç¡®ä¿é€šè¿‡

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ï¼Œè¯¦è§LICENSEæ–‡ä»¶ã€‚

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š
- æäº¤Issue: [GitHub Issues](https://github.com/your-repo/issues)
- å‘é€é‚®ä»¶: your-email@example.com 